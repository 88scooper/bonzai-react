Priority,Category,Issue,Description,Impact,Recommendation,Files Affected,Estimated Effort,Status
Critical,Amortization Schedule,Payment Date Calculation Uses Approximate Intervals,Monthly payments use 30-day intervals instead of calendar months. Semi-monthly uses 15-day intervals instead of 1st/15th of month. This causes incorrect payment dates that affect renewal dates and balance calculations.,Payment dates are incorrect, affecting renewal dates, balance at specific dates, and property cash flow alignment. Payment schedules don't match actual mortgage payment dates.,Replace getPaymentIntervalDays() approximate intervals with calendar-based date calculations. For monthly: use setMonth() or date-fns addMonths(). For semi-monthly: use 1st and 15th of month. For bi-weekly/weekly: current 14/7 day intervals are correct.,src/utils/mortgageCalculator.ts (lines 240-255, 321, 333),4 hours,Open
Critical,Data Processing,API Schema Allows Required Fields to be Optional,API schema (mortgage.schema.ts) marks required fields (lender, originalAmount, interestRate, etc.) as .optional() when they should be required. This contradicts form validation.,Invalid mortgages could be saved via API if validation is bypassed. Data integrity not enforced at API level.,Remove .optional() from required fields in createMortgageSchema. Ensure API schema matches form schema validation requirements.,src/lib/validations/mortgage.schema.ts (lines 8-15),1 hour,Open
High,Calculations,Dual Calculation Systems Create Maintenance Risk,Two mortgage calculation systems exist: mortgageCalculator.ts (primary) and mortgage-calculations.js (legacy). Both implement similar logic but with different approaches, creating risk of divergence and confusion.,Maintenance burden increases. Risk of calculations diverging between systems. Developers may use wrong calculator. Potential for inconsistent results.,Deprecate mortgage-calculations.js. Ensure all code uses mortgageCalculator.ts exclusively. Update all imports to use primary calculator. Add deprecation warnings to legacy file.,src/lib/mortgage-calculations.js (entire file),2 hours,Open
High,Data Processing,Database Schema Lacks NOT NULL Constraints,Database schema allows all mortgage fields to be NULL, even though they are required for valid mortgages. This doesn't enforce data integrity at database level.,Invalid mortgages could be saved if application-level validation is bypassed. Database doesn't enforce data integrity.,Add NOT NULL constraints to required fields (lender, original_amount, interest_rate, rate_type, term_months, amortization_years, payment_frequency, start_date). Create migration file.,migrations/001_initial_schema.sql (lines 50-64),1 hour,Open
Medium,Calculations,No Automated Tests Against Canadian Lender Calculators,Calculation accuracy has not been verified against professional Canadian mortgage calculators (RBC, TD, CIBC, BMO, Scotiabank). Only Richmond mortgage uses lender-provided data for validation.,Calculation accuracy unverified. Potential for undetected calculation errors. Cannot guarantee results match industry standards.,Create comprehensive test suite comparing Bonzai calculations against known good values from Canadian lender calculators. Test multiple scenarios (monthly, bi-weekly, different rates, different amortizations).,Test files (new),4 hours,Open
Medium,Calculations,Variable Rate Compounding Logic Needs Verification,Variable rate mortgages use different compounding than fixed rates (monthly vs semi-annual), but implementation needs verification against Canadian standards. Variable rate logic is less tested than fixed rate.,Most mortgages are fixed-rate, but variable rate mortgages may have calculation errors if logic is incorrect.,Verify variable rate compounding uses monthly compounding (not semi-annual). Test against Canadian lender calculators for variable rate mortgages. Document compounding differences.,src/utils/mortgageCalculator.ts (lines 212-235),2 hours,Open
Medium,Data Processing,Interest Rate Database Precision May Be Insufficient,DECIMAL(5,4) allows maximum 9.9999% interest rate. Canadian mortgage rates can exceed 10% (though rare in current market). Precision should support rates up to at least 50% (as validated in forms).,Very high interest rates (above 9.9999%) cannot be stored. While rare, this is a data type limitation that could cause issues.,Change interest_rate column from DECIMAL(5,4) to DECIMAL(6,4) to support rates up to 99.9999%. This matches validation limits in forms (max 50%).,migrations/001_initial_schema.sql (line 55),30 minutes,Open
Medium,Amortization Schedule,Semi-Monthly Payment Calculation Needs Verification,Semi-monthly payments use monthly periodic rate (correct), but payment date calculation uses 15-day intervals. Need to verify payment amount calculation matches Canadian standards (typically Monthly Payment / 2, paid 24 times/year).,Semi-monthly payment amounts may not match industry standards. Payment dates definitely incorrect (uses 15-day intervals instead of 1st/15th).,Verify semi-monthly payment amount calculation. Fix payment dates to use 1st and 15th of each month instead of 15-day intervals.,src/utils/mortgageCalculator.ts (lines 224, 244-245),2 hours,Open
Low,Data Collection,Mortgage Number Not Collected in Standard Form,Mortgage number/account number is only stored for Richmond mortgage special case in mortgageData JSONB field. Not collected in standard mortgage form.,Cannot track mortgage account numbers for mortgages other than Richmond. This is useful for communication with lenders but not critical for calculations.,Add optional mortgageNumber field to mortgage form. Store in mortgageData JSONB field or as separate column. Update form validation schema.,src/components/mortgages/MortgageFormUpgraded.jsx,src/lib/mortgage-validation.js,2 hours,Open
Low,Data Collection,Prepayment Privileges Not Collected,Prepayment privileges (annual % limit, lump sum options) are not collected in mortgage forms. These are useful for financial planning but not required for core calculations.,Prepayment analysis features cannot use actual mortgage terms. Users cannot track prepayment limits. Nice-to-have feature limitation.,Add optional prepayment fields to mortgage form: annualPrepaymentLimit (%), allowsLumpSumPrepayment (boolean), lumpSumPrepaymentLimit (%). Store in mortgageData JSONB field.,src/components/mortgages/MortgageFormUpgraded.jsx,src/lib/mortgage-validation.js,migrations/001_initial_schema.sql,3 hours,Open
Low,Data Collection,Renewal Penalty Information Not Collected,Renewal penalty type (IRD vs 3-month interest) is not collected. This is useful for financial planning when considering refinancing but not required for core calculations.,Cannot calculate accurate renewal penalties for refinance analysis. Nice-to-have feature limitation.,Add optional renewalPenaltyType field (enum: IRD, THREE_MONTH_INTEREST, OTHER) and renewalPenaltyRate field. Store in mortgageData JSONB field.,src/components/mortgages/MortgageFormUpgraded.jsx,src/lib/mortgage-validation.js,2 hours,Open
Low,Display,Payment Date Formatting May Display Incorrect Dates,While date formatting itself is correct, the underlying payment dates are incorrect (from Critical Issue #1). This causes incorrect dates to be displayed to users.,Users see incorrect payment dates in UI. Trust in application decreases. Potential confusion when comparing to lender statements.,Fix underlying payment date calculation (Critical Issue #1) to automatically fix display issue. No separate display fix needed if calculation is corrected.,src/utils/mortgageCalculator.ts (will be fixed with Critical Issue #1),0 hours (included in Critical #1),Open
